# OpenIPC Wiki 
[内容](../README.zh.md)

安装 OpenIPC。步步。 
--------------------------------

### 步骤 1：确定您的处理器类型。

![SoC Marking](../images/soc-hisilicon.webp)
![SoC Marking](../images/soc-ingenic-t20.webp)
![SoC Marking](../images/soc-ingenic-t31.webp)
![SoC Marking](../images/soc-ingenic-t40.webp)

_海思Hi3518EV100、君正T20、T31和T40处理器的标记示例。重要字符用黄色圈出。_

### 步骤 2. 下载固件。

在 <https://github.com/OpenIPC/firmware> 中查找您的处理器类型，并确保固件可用。如果您幸运并且存在此类固件，请将其下载到您的计算机上。

### 步骤 3：安装并配置 TFTP 服务器。

TFTP 代表简单文件传输协议。顾名思义，这是一个非常简单的协议，旨在通过计算机网络传输文件。 TFTP 不支持身份验证。它的代码非常简单和紧凑，以至于TFTP客户端可以在网络和嵌入式系统中使用，以从网络服务器获取启动映像。

#### 如果您的计算机是 Linux。

如果你的计算机上安装了Linux，那么一切就很简单了。已编译且可立即使用的 TFTP 服务器包已在存储库中，您只需安装并配置它：

```
sudo apt install tftpd-hpa
sudo sed -i '/^TFTP_OPTIONS/s/"$/ --create"/' /etc/default/tftpd-hpa
sudo systemctl restart tftpd-hpa.service
```

现在您拥有自己的 TFTP 服务器，可以处理"/srv/tftp"目录中的文件。将步骤 2 中下载的固件的存档展开到此目录中。

```
sudo tar -C /srv/tftp/ -xvf openipc.*.tgz
```

### 步骤4：连接相机的UART端口。

要通过 UART 端口连接到相机，您需要一个[适配器][ftdi]来从计算机的串行端口创建连接。

![UART 模块](../images/uart-module.webp)

__在将适配器连接到相机之前，请确保适配器上的工作电压等级开关设置为3.3伏！__有时将跳线设置到适当的位置就足够了，有时需要重新焊接适配器上的按键接触垫。有些适配器仅适用于 5 伏电压。在这种情况下，您需要在适配器和相机的 UART 端口之间连接一个额外的 TTL 信号电平 [转换器][tllc]。

您需要的 UART 端口引脚之一是"GND"。通过用万用表检查电路与任何其他已知"GND"触点的连续性可以轻松确定。找到了吗？然后还需要找到两个触点——"RX"和"TX"，它们分别用于接收和发送数据。将相机的"GND"引脚连接到适配器的"GND"引脚，将适配器的USB连接器连接到计算机的USB端口，在计算机上运行串口连接程序并与适配器建立连接。使用 115200 bps 的连接速度。此后，将适配器的"RX"引脚连接到 UART 端口的预期"TX"引脚。给相机通电。如果您猜对了，下载日志将出现在屏幕上。如果屏幕仍然空白，请使用另一个空闲的 UART 联系人重复此过程。确定"RX"端口后，将适配器的"TX"端口连接到 UART 端口的剩余空闲引脚。尝试按计算机键盘上的组合键来中断相机加载。如果一切顺利，恭喜您，您已经可以使用相机了。

UART 端口的第四个引脚可以是"VCC"。出厂时用于相机闪光时供电。我们强烈建议不要通过"VCC"UART 端口连接相机电源，而是使用标准电源连接器。

### 步骤 5：访问引导加载程序控制台。

重新启动相机并尝试通过在加载开始和 Linux 内核启动之间按所需的组合键来访问引导加载程序控制台。在大多数情况下，这是组合"Ctrl-C"。不太常见 - `Enter`、Esc` 或任意键。但有些相机需要更奇特的组合。加载时阅读屏幕上的文本。如果仔细阅读日志没有帮助，请在我们的 Telegram 频道上寻求帮助。最有可能的是，我们已经处理过类似的相机。

从现在开始，我们强烈建议您记录您所做的一切。启用在控制台客户端中保存会话日志。但为了获得更高的可靠性，请在计算机上创建一个文本文件，并将所有执行的命令和系统响应输入到其中。

### 步骤 6. 保存出厂固件。

一旦您可以访问引导加载程序控制台，请输入"help"以显示可用命令的列表。确保"tftp"位于命令列表中。如果有这样的命令，那么保存原始固件应该不会出现问题。您只需配置摄像机对 TFTP 服务器的网络访问即可。

注意！如果您的引导加载程序没有 tftp，您仍然可以复制原始固件。 [详细信息请参见此处](help-uboot.md)。

使用"printenv"命令检查您的系统环境设置。您对网络连接设置感兴趣："ipaddr"、"netmask"、"gatewayip"和"serverip"。前三个参数设置摄像机的 IP 地址和网络掩码、连接本地网络的网关 IP 地址。第四个参数是 TFTP 服务器的 IP 地址，使用"tftp"命令将文件从该服务器传输到该服务器。使用"setenv"命令设置所需的值（使用适合您网络的 IP 地址和网络掩码）。使用"saveenv"命令保存设置。

```
setenv ipaddr 192.168.1.253
setenv netmask 255.255.255.0
setenv gatewayip 192.168.1.1
setenv serverip 192.168.1.254
saveenv
```

如今大多数网络摄像机都配备了Nor或Nand闪存芯片，容量为8或16兆字节。您可以在引导加载程序日志输出中查看相机上安装的芯片的类型和大小。会有这样的事情：

```
U-Boot 2010.06-svn (Oct 21 2016 - 11:21:29)

Check Flash Memory Controller v100 ... Found
SPI Nor(cs 0) ID: 0xс2 0x20 0x18
spi_general_qe_enable(294): Error: Disable Quad failed! reg: 0x2
Block:64KB Chip:16MB Name:"MX25L128XX"
SPI Nor total size: 16MB
```

要将闪存的内容保存到文件中，必须首先将内容加载到 RAM 中。清除足够大的RAM区域的内容以容纳闪存的内容，然后将闪存的内容读取到准备好的RAM区域中，并将从RAM中读取的数据作为文件上传到TFTP服务器。

不同的处理器、不同大小的存储芯片、不同的引导地址不允许我们在这里呈现一组通用的命令。有关适合您的特定配置的命令列表，请使用我们网站上的[自动指令生成器](https://openipc.org/supported-hardware/)。

### 步骤 7：安装 OpenIPC 固件。

不同的相机型号具有不同的组件集。其中最重要的是处理器和传感器，直接影响特定相机固有的图像质量和功能集。但即使是看似不太重要的细节也可能对相机及其固件的功能造成限制。例如，不同的相机可能安装有不同的闪存芯片。有些相机可能有 8 MB 闪存，而其他相机可能有 16 MB 甚至更多。较大容量的闪存可以容纳更多程序代码，从而使相机能够运行具有较小闪存容量的相机所无法提供的附加服务。因此，我们决定收集两个版本的固件：适用于具有 8 MB 闪存的相机的基本版本 (_Lite_) 和具有附加功能的扩展版本 (_Ultimate_)，适用于具有更多闪存的相机。

在不同相机型号上安装固件的过程因使用的内存地址和环境变量中设置的参数不同而有所不同，因此在继续之前，请准确确定相机上安装的处理器类型、传感器型号以及内存量。

有关适合您的特定配置的命令列表，请使用我们网站上的[自动指令生成器](https://openipc.org/supported-hardware/)。

### 步骤 8. 首次启动。

如果前面的所有步骤均正确完成，您的相机应使用新固件启动。欢迎来到 OpenIPC！

使用新固件首次启动后，需要通过运行程序清除重叠分区

```
firstboot
```

[logo]: ../images/logo_openipc.png
[ftdi]: https://www.google.com/search?q=ftdi+usb+ttl
[tllc]: https://google.com/search?q=logic+level+converter+3.3v+5v
